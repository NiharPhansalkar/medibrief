from sparknlp_jsl.common import *
from sparknlp_jsl.annotator.seq2seq.medical_encoder_decoder import MedicalEncoderDecoder


class MedicalSummarizer(MedicalEncoderDecoder):
    name = "MedicalSummarizer"

    @keyword_only
    def __init__(self, classname="com.johnsnowlabs.nlp.annotators.seq2seq.MedicalSummarizer", java_model=None):
        super(MedicalSummarizer, self).__init__(
            classname=classname,
            java_model=java_model
        )

        self._setDefault(
            task="summarize: "
        )

    @staticmethod
    def loadSavedModel(folder, spark_session, use_cache=True):
        """Loads a locally saved model.

        Parameters
        ----------
        folder : str
            Folder of the saved model
        spark_session : pyspark.sql.SparkSession
            The current SparkSession
        use_cache: bool
            The model uses caching to facilitate performance

        Returns
        -------
        MedicalSummarizer
            The restored model
        """
        from sparknlp_jsl.internal import _MedicalSummarizerLoader
        jModel = _MedicalSummarizerLoader(folder, spark_session._jsparkSession, use_cache)._java_obj
        return MedicalSummarizer(java_model=jModel)

    @staticmethod
    def pretrained(name="summarizer_clinical_jsl_augmented", lang="en", remote_loc="clinical/models"):
        """Downloads and loads a pretrained model.

        Parameters
        ----------
        name : str, optional
            Name of the pretrained model, by default "summarizer_clinical_jsl_augmented"
        lang : str, optional
            Language of the pretrained model, by default "en"
        remote_loc : str, optional
            Optional remote address of the resource, by default None. Will use
            Spark NLPs repositories otherwise.

        Returns
        -------
        MedicalSummarizer
            The restored model
        """
        from sparknlp_jsl.pretrained import InternalResourceDownloader
        return InternalResourceDownloader.downloadModel(MedicalSummarizer, name, lang, remote_loc,
                                                        j_dwn='InternalsPythonResourceDownloader')